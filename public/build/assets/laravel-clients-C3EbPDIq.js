document.addEventListener("DOMContentLoaded",function(i){const l=document.querySelector(".datatables-clients"),r=document.getElementById("offcanvasAddClients"),o=document.getElementById("addNewClientsForm"),c=document.getElementById("sectionPF"),s=document.getElementById("sectionPJ");if(document.querySelectorAll(".client-type-toggle").forEach(d=>{d.addEventListener("change",function(){this.value==="PF"?(c.classList.remove("d-none"),s.classList.add("d-none")):(c.classList.add("d-none"),s.classList.remove("d-none"))})}),l){const d=new DataTable(l,{processing:!0,serverSide:!0,ajax:{url:baseUrl+"clients-list"},columns:[{data:"id"},{data:"id"},{data:"type"},{data:"name"},{data:"document"},{data:"email"},{data:"vehicles_count"},{data:"action"}],columnDefs:[{className:"control",orderable:!1,targets:0,render:()=>""},{targets:2,render:t=>`<span class="badge bg-label-${t==="PF"?"success":"info"}">${t}</span>`},{targets:3,render:(t,a,e)=>`
                            <div class="d-flex flex-column">
                                <span class="fw-medium text-heading">${t}</span>
                                <small class="text-muted">${e.whatsapp||"-"}</small>
                            </div>
                        `},{targets:6,render:t=>`<span class="badge rounded-pill bg-label-primary">${t} veículos</span>`},{targets:7,title:"Ações",orderable:!1,render:(t,a,e)=>`<div class="d-flex align-items-center gap-2"><button class="btn btn-sm btn-icon edit-record" data-id="${e.id}" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddClients"><i class="ti tabler-edit"></i></button><button class="btn btn-sm btn-icon delete-record" data-id="${e.id}"><i class="ti tabler-trash"></i></button></div>`}],order:[[1,"desc"]],layout:{topEnd:{features:[{search:{placeholder:"Buscar cliente..."}}]}}});document.addEventListener("click",function(t){if(t.target.closest(".delete-record")){const a=t.target.closest(".delete-record").dataset.id;Swal.fire({title:"Excluir cliente?",text:"Isso removerá também o vínculo com veículos!",icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, excluir",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-secondary"},buttonsStyling:!1}).then(e=>{e.value&&fetch(`${baseUrl}clients-list/${a}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}).then(()=>d.draw())})}}),document.addEventListener("click",function(t){if(t.target.closest(".edit-record")){const a=t.target.closest(".edit-record").dataset.id;document.getElementById("offcanvasAddClientsLabel").innerHTML="Editar Cliente",fetch(`${baseUrl}clients-list/${a}/edit`).then(e=>e.json()).then(e=>{document.getElementById("client_id").value=e.id,e.type==="PF"?(document.getElementById("typePF").checked=!0,c.classList.remove("d-none"),s.classList.add("d-none"),document.querySelector('[name="name"]').value=e.name,document.querySelector('[name="cpf"]').value=e.cpf):(document.getElementById("typePJ").checked=!0,c.classList.add("d-none"),s.classList.remove("d-none"),document.querySelector('[name="company_name"]').value=e.company_name,document.querySelector('[name="cnpj"]').value=e.cnpj),document.querySelector('[name="email"]').value=e.email||"",document.querySelector('[name="whatsapp"]').value=e.whatsapp||"",document.querySelector('[name="cep"]').value=e.cep||"",document.querySelector('[name="rua"]').value=e.rua||"",document.querySelector('[name="numero"]').value=e.numero||"",document.querySelector('[name="bairro"]').value=e.bairro||"",document.querySelector('[name="cidade"]').value=e.cidade||"",document.querySelector('[name="estado"]').value=e.estado||""})}});const n=document.querySelector(".add-new");n&&n.addEventListener("click",()=>{document.getElementById("client_id").value="",document.getElementById("offcanvasAddClientsLabel").innerHTML="Cadastrar Cliente",o.reset(),document.getElementById("typePF").checked=!0,c.classList.remove("d-none"),s.classList.add("d-none")})}o&&o.addEventListener("submit",function(d){d.preventDefault();const n=document.getElementById("client_id").value,t=n?`${baseUrl}clients-list/${n}`:`${baseUrl}clients-list`;fetch(t,{method:n?"PUT":"POST",body:new URLSearchParams(new FormData(o)),headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content"),"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e.json()).then(e=>{e.success&&(bootstrap.Offcanvas.getInstance(r).hide(),location.reload())})})});
