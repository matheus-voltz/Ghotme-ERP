document.addEventListener("DOMContentLoaded",function(d){const i=document.querySelector(".datatables-services"),c=document.getElementById("offcanvasService"),s=document.getElementById("formService");if(i){const r=new DataTable(i,{processing:!0,serverSide:!0,ajax:{url:baseUrl+"services/list"},columns:[{data:"fake_id"},{data:"name"},{data:"price"},{data:"estimated_time"},{data:"is_active"},{data:"action"}],columnDefs:[{targets:1,render:function(t,a,e){return`<span class="fw-medium text-heading">${t}</span>`}},{targets:2,render:function(t){return`R$ ${parseFloat(t).toFixed(2)}`}},{targets:3,render:function(t){return t?`${t} min`:"-"}},{targets:4,className:"text-center",render:function(t){return t?'<span class="badge bg-label-success">Ativo</span>':'<span class="badge bg-label-danger">Inativo</span>'}},{targets:5,title:"Ações",orderable:!1,render:function(t,a,e){return`<div class="d-flex align-items-center gap-2"><button class="btn btn-sm btn-icon edit-record" data-id="${e.id}" data-bs-toggle="offcanvas" data-bs-target="#offcanvasService"><i class="ti tabler-edit"></i></button><button class="btn btn-sm btn-icon delete-record" data-id="${e.id}"><i class="ti tabler-trash"></i></button></div>`}}],order:[[1,"asc"]],layout:{topEnd:{features:[{search:{placeholder:"Procurar serviço"}},{buttons:[{text:'<i class="ti tabler-plus me-1"></i> Adicionar Serviço',className:"add-new btn btn-primary",attr:{"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasService"}}]}]}}});document.addEventListener("click",function(t){if(t.target.closest(".delete-record")){const a=t.target.closest(".delete-record").dataset.id;Swal.fire({title:"Confirmar exclusão?",text:"Esta ação não pode ser revertida!",icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, excluir!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-secondary"},buttonsStyling:!1}).then(function(e){e.value&&fetch(`${baseUrl}services/${a}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(o=>o.json()).then(o=>{o.success&&(r.draw(),Swal.fire({icon:"success",title:"Excluído!",text:o.message,customClass:{confirmButton:"btn btn-success"}}))})})}}),document.addEventListener("click",function(t){if(t.target.closest(".edit-record")){const a=t.target.closest(".edit-record").dataset.id;document.getElementById("offcanvasServiceLabel").innerHTML="Editar Serviço",fetch(`${baseUrl}services/${a}/edit`).then(e=>e.json()).then(e=>{document.getElementById("service_id").value=e.id,document.getElementById("service-name").value=e.name,document.getElementById("service-price").value=e.price,document.getElementById("service-time").value=e.estimated_time,document.getElementById("service-description").value=e.description||""})}});const n=document.querySelector(".add-new");n&&n.addEventListener("click",function(){document.getElementById("service_id").value="",document.getElementById("offcanvasServiceLabel").innerHTML="Adicionar Serviço",s.reset()})}s&&FormValidation.formValidation(s,{fields:{name:{validators:{notEmpty:{message:"Nome é obrigatório"}}},price:{validators:{notEmpty:{message:"Preço é obrigatório"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".mb-6"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){const r=new FormData(s),n=r.get("id"),t=n?`${baseUrl}services/${n}`:`${baseUrl}services`;fetch(t,{method:n?"PUT":"POST",body:new URLSearchParams(r),headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e.json()).then(e=>{e.success&&(bootstrap.Offcanvas.getInstance(c).hide(),new DataTable(i).draw(),Swal.fire({icon:"success",title:"Sucesso!",text:e.message,customClass:{confirmButton:"btn btn-success"}}))})})});
