document.addEventListener("DOMContentLoaded",function(u){config.colors.borderColor,config.colors.bodyBg,config.colors.headingColor;const s=document.querySelector(".datatables-suppliers"),l=document.getElementById("offcanvasAddSuppliers");if($.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),s){const i=new DataTable(s,{processing:!0,serverSide:!0,ajax:{url:baseUrl+"inventory/suppliers-list",dataSrc:function(t){return typeof t.recordsTotal!="number"&&(t.recordsTotal=0),typeof t.recordsFiltered!="number"&&(t.recordsFiltered=0),t.data=Array.isArray(t.data)?t.data:[],t.data}},columns:[{data:"fake_id"},{data:"id"},{data:"name"},{data:"contact_name"},{data:"email"},{data:"phone"},{data:"city"},{data:"is_active"},{data:"action"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(t,n,e,a){return""}},{searchable:!1,orderable:!1,targets:1,render:function(t,n,e,a){return`<span>${e.fake_id}</span>`}},{targets:2,responsivePriority:4,render:function(t,n,e,a){return`<div class="d-flex flex-column"><span class="fw-medium text-heading">${e.name}</span><small class="text-muted">${e.trade_name||""}</small></div>`}},{targets:3,render:function(t,n,e,a){return e.contact_name||"-"}},{targets:4,render:function(t,n,e,a){return e.email||"-"}},{targets:5,render:function(t,n,e,a){return e.phone||"-"}},{targets:6,render:function(t,n,e,a){return e.city||"-"}},{targets:7,className:"text-center",render:function(t,n,e,a){return e.is_active?'<span class="badge bg-success">Ativo</span>':'<span class="badge bg-danger">Inativo</span>'}},{targets:8,title:"Ações",searchable:!1,orderable:!1,render:function(t,n,e,a){return`<div class="d-flex align-items-center gap-4"><button class="btn btn-sm btn-icon edit-record" data-id="${e.id}" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddSuppliers"><i class="icon-base ti tabler-edit icon-22px"></i></button><button class="btn btn-sm btn-icon delete-record" data-id="${e.id}"><i class="icon-base ti tabler-trash icon-22px"></i></button></div>`}}],order:[[2,"asc"]],layout:{topStart:{rowClass:"row m-3 my-0 justify-content-between",features:[{pageLength:{menu:[10,20,50,100],text:"_MENU_"}}]},topEnd:{features:[{search:{placeholder:"Procurar fornecedor",text:"_INPUT_"}},{buttons:[{text:'<i class="icon-base ti tabler-plus icon-sm me-0 me-sm-2"></i><span class="d-none d-sm-inline-block">Adicionar Fornecedor</span>',className:"add-new btn btn-primary",attr:{"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasAddSuppliers"}}]}]},bottomStart:{rowClass:"row mx-3 justify-content-between",features:[{info:{text:"Showing _START_ to _END_ of _TOTAL_ entries"}}]},bottomEnd:"paging"},displayLength:10,responsive:{details:{display:DataTable.Responsive.display.modal({header:function(t){return"Detalhes de "+t.data().name}}),type:"column",renderer:function(t,n,e){const a=e.map(r=>r.title!==""?`<tr data-dt-row="${r.rowIndex}" data-dt-column="${r.columnIndex}"><td>${r.title}:</td><td>${r.data}</td></tr>`:"").join("");return a?`<div class="table-responsive"><table class="table"><tbody>${a}</tbody></table></div>`:!1}}}});document.addEventListener("click",function(t){if(t.target.closest(".delete-record")){const n=t.target.closest(".delete-record").dataset.id;Swal.fire({title:"Você tem certeza?",text:"Você não poderá reverter isso!",icon:"warning",showCancelButton:!0,confirmButtonText:"Sim, exclua!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-secondary"},buttonsStyling:!1}).then(function(e){e.value&&fetch(`${baseUrl}inventory/suppliers/${n}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"}}).then(a=>{a.ok&&(i.draw(),Swal.fire({icon:"success",title:"Excluído!",text:"O fornecedor foi excluído!",customClass:{confirmButton:"btn btn-success"}}))})})}}),document.addEventListener("click",function(t){if(t.target.closest(".edit-record")){const n=t.target.closest(".edit-record").dataset.id;document.getElementById("offcanvasAddSuppliersLabel").innerHTML="Editar Fornecedor",fetch(`${baseUrl}inventory/suppliers/${n}/edit`).then(e=>e.json()).then(e=>{document.getElementById("supplier_id").value=e.id,document.getElementById("add-supplier-name").value=e.name,document.getElementById("add-supplier-trade-name").value=e.trade_name||"",document.getElementById("add-supplier-contact-name").value=e.contact_name||"",document.getElementById("add-supplier-email").value=e.email||"",document.getElementById("add-supplier-phone").value=e.phone||"",document.getElementById("add-supplier-document").value=e.document||"",document.getElementById("add-supplier-city").value=e.city||"",document.getElementById("add-supplier-address").value=e.address||""})}});const o=document.querySelector(".add-new");o&&o.addEventListener("click",function(){document.getElementById("supplier_id").value="",document.getElementById("offcanvasAddSuppliersLabel").innerHTML="Adicionar Fornecedor",document.getElementById("addNewSuppliersForm").reset()})}const d=document.getElementById("addNewSuppliersForm");d&&FormValidation.formValidation(d,{fields:{name:{validators:{notEmpty:{message:"Por favor preencha a Razão Social"}}},email:{validators:{emailAddress:{message:"O email não é válido"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".mb-6"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){const i=new FormData(d),o={};i.forEach((r,c)=>o[c]=r);const t=o.id,n=t?`${baseUrl}inventory/suppliers/${t}`:`${baseUrl}inventory/suppliers`,e=t?"PUT":"POST",a=new URLSearchParams;for(const[r,c]of Object.entries(o))a.append(r,c);fetch(n,{method:e,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()}).then(r=>{if(!r.ok)throw new Error("Error");return r.json()}).then(r=>{s&&new DataTable(s).draw(),bootstrap.Offcanvas.getInstance(l).hide(),Swal.fire({icon:"success",title:"Sucesso!",text:r.message,customClass:{confirmButton:"btn btn-success"}})})})});
