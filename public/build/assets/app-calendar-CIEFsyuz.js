document.addEventListener("DOMContentLoaded",function(){const B=window.isRtl||!1,I=window.assetsPath||"/assets/",Y=B?"rtl":"ltr";(function(){const L=window.Calendar,O=window.dayGridPlugin,R=window.interactionPlugin,H=window.listPlugin,j=window.timegridPlugin,v=window.FormValidation;if(!L){console.error("FullCalendar components not found");return}const N=document.getElementById("calendar"),D=document.querySelector(".app-calendar-sidebar"),A=document.getElementById("addEventSidebar"),P=document.querySelector(".app-overlay"),c=document.querySelector(".offcanvas-title"),T=document.querySelector(".btn-toggle-sidebar"),o=document.getElementById("addEventBtn"),g=document.querySelector(".btn-delete-event"),G=document.querySelector(".btn-cancel"),p=document.getElementById("eventTitle"),i=document.getElementById("eventStartDate"),d=document.getElementById("eventEndDate"),h=document.getElementById("eventURL"),b=document.getElementById("eventLocation"),y=document.getElementById("eventDescription"),m=document.querySelector(".allDay-switch"),S=document.querySelector(".select-all"),C=Array.from(document.querySelectorAll(".input-filter")),M=document.querySelector(".inline-calendar"),k={weekdays:{shorthand:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],longhand:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"]},months:{shorthand:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],longhand:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"]},rangeSeparator:" até ",time_24hr:!0},J={Business:"primary",Holiday:"success",Personal:"danger",Family:"warning",ETC:"info"},u=$("#eventLabel"),s=$("#eventGuests");let E=!1,r=null,x=null;const f=new bootstrap.Offcanvas(A);//! TODO: Update Event label and guest code to JS once select removes jQuery dependency
if(u.length){let e=function(t){if(!t.id)return t.text;var n="<span class='badge badge-dot bg-"+$(t.element).data("label")+" me-2'> </span>"+t.text;return n};var te=e;u.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:u.parent(),templateResult:e,templateSelection:e,minimumResultsForSearch:-1,escapeMarkup:function(t){return t}})}if(s.length){let e=function(t){return t.id?`
    <div class='d-flex flex-wrap align-items-center'>
      <div class='avatar avatar-xs me-2'>
        <img src='${I}img/avatars/${$(t.element).data("avatar")}'
          alt='avatar' class='rounded-circle' />
      </div>
      ${t.text}
    </div>`:t.text};var ne=e;s.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:s.parent(),closeOnSelect:!1,templateResult:e,templateSelection:e,escapeMarkup:function(t){return t}})}if(i)var V=i.flatpickr({monthSelectorType:"static",static:!0,enableTime:!0,altFormat:"Y-m-dTH:i:S",locale:k,onReady:function(e,t,n){n.isMobile&&n.mobileInput.setAttribute("step",null)}});if(d)var q=d.flatpickr({monthSelectorType:"static",static:!0,enableTime:!0,altFormat:"Y-m-dTH:i:S",locale:k,onReady:function(e,t,n){n.isMobile&&n.mobileInput.setAttribute("step",null)}});M&&(x=M.flatpickr({monthSelectorType:"static",static:!0,inline:!0,locale:k}));function z(e){r=e.event,r.url&&e.jsEvent.preventDefault(),f.show(),c&&(c.innerHTML="Atualizar Evento"),o.innerHTML="Atualizar",o.classList.add("btn-update-event"),o.classList.remove("btn-add-event"),g.classList.remove("d-none"),p.value=r.title,V.setDate(r.start,!0,"Y-m-d"),r.allDay===!0?m.checked=!0:m.checked=!1,r.end!==null?q.setDate(r.end,!0,"Y-m-d"):q.setDate(r.start,!0,"Y-m-d"),u.val(r.extendedProps.calendar).trigger("change"),r.extendedProps.location!==void 0&&(b.value=r.extendedProps.location),r.extendedProps.guests!==void 0&&s.val(r.extendedProps.guests).trigger("change"),r.extendedProps.description!==void 0&&(y.value=r.extendedProps.description)}function w(){const e=document.querySelector(".fc-sidebarToggle-button");for(e.classList.remove("fc-button-primary"),e.classList.add("d-lg-none","d-inline-block","ps-0");e.firstChild;)e.firstChild.remove();e.setAttribute("data-bs-toggle","sidebar"),e.setAttribute("data-overlay",""),e.setAttribute("data-target","#app-calendar-sidebar"),e.insertAdjacentHTML("beforeend",'<i class="icon-base ti tabler-menu-2 icon-lg text-heading"></i>')}function Q(){let e=[];return[].slice.call(document.querySelectorAll(".input-filter:checked")).forEach(n=>{e.push(n.getAttribute("data-value"))}),e}function U(e,t){let n=Q();fetch("/calendar/events").then(a=>a.json()).then(a=>{let Z=a.filter(function(ee){return n.includes(ee.extendedProps.calendar.toLowerCase())});t(Z)}).catch(a=>{console.error("Error fetching events:",a),t([])})}let l=new L(N,{initialView:"dayGridMonth",locale:"pt-br",buttonText:{today:"Hoje",month:"Mês",week:"Semana",day:"Dia",list:"Agenda"},events:U,plugins:[O,R,H,j],editable:!0,dragScroll:!0,dayMaxEvents:2,eventResizableFromStart:!0,customButtons:{sidebarToggle:{text:"Sidebar"}},headerToolbar:{start:"sidebarToggle, prev,next, title",end:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},direction:Y,initialDate:new Date,navLinks:!0,eventClassNames:function({event:e}){return["bg-label-"+J[e._def.extendedProps.calendar]]},dateClick:function(e){let t=moment(e.date).format("YYYY-MM-DD");F(),f.show(),c&&(c.innerHTML="Adicionar Evento"),o.innerHTML="Adicionar",o.classList.remove("btn-update-event"),o.classList.add("btn-add-event"),g.classList.add("d-none"),i.value=t,d.value=t},eventClick:function(e){z(e)},datesSet:function(){w()},viewDidMount:function(){w()}});l.render(),w();const K=document.getElementById("eventForm");v.formValidation(K,{fields:{eventTitle:{validators:{notEmpty:{message:"Por favor, digite o título do evento"}}},eventStartDate:{validators:{notEmpty:{message:"Por favor, digite a data de início"}}},eventEndDate:{validators:{notEmpty:{message:"Por favor, digite a data de término"}}}},plugins:{trigger:new v.plugins.Trigger,bootstrap5:new v.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(e,t){return".form-control-validation"}}),submitButton:new v.plugins.SubmitButton,autoFocus:new v.plugins.AutoFocus}}).on("core.form.valid",function(){E=!0}).on("core.form.invalid",function(){E=!1}),T&&T.addEventListener("click",e=>{G.classList.remove("d-none")});function X(e){var n;const t=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");fetch("/calendar/events",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t},body:JSON.stringify(e)}).then(a=>a.json()).then(a=>{l.refetchEvents()}).catch(a=>console.error("Error adding event:",a))}function _(e){var n;const t=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");fetch("/calendar/events/"+e.id,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t},body:JSON.stringify(e)}).then(a=>a.json()).then(a=>{l.refetchEvents()}).catch(a=>console.error("Error updating event:",a))}function W(e){var n;const t=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");fetch("/calendar/events/"+e,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t}}).then(a=>a.json()).then(a=>{l.refetchEvents()}).catch(a=>console.error("Error deleting event:",a))}o.addEventListener("click",e=>{if(o.classList.contains("btn-add-event")){if(E){let t={id:l.getEvents().length+1,title:p.value,start:i.value,end:d.value,startStr:i.value,endStr:d.value,display:"block",extendedProps:{location:b.value,guests:s.val(),calendar:u.val(),description:y.value}};h.value&&(t.url=h.value),m.checked&&(t.allDay=!0),X(t),f.hide()}}else if(E){let t={id:r.id,title:p.value,start:i.value,end:d.value,url:h.value,extendedProps:{location:b.value,guests:s.val(),calendar:u.val(),description:y.value},display:"block",allDay:!!m.checked};_(t),f.hide()}}),g.addEventListener("click",e=>{W(parseInt(r.id)),f.hide()});function F(){d.value="",h.value="",i.value="",p.value="",b.value="",m.checked=!1,s.val("").trigger("change"),y.value=""}A.addEventListener("hidden.bs.offcanvas",function(){F()}),T.addEventListener("click",e=>{c&&(c.innerHTML="Adicionar Evento"),o.innerHTML="Adicionar",o.classList.remove("btn-update-event"),o.classList.add("btn-add-event"),g.classList.add("d-none"),D.classList.remove("show"),P.classList.remove("show")}),S&&S.addEventListener("click",e=>{e.currentTarget.checked?document.querySelectorAll(".input-filter").forEach(t=>t.checked=1):document.querySelectorAll(".input-filter").forEach(t=>t.checked=0),l.refetchEvents()}),C&&C.forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".input-filter:checked").length<document.querySelectorAll(".input-filter").length?S.checked=!1:S.checked=!0,l.refetchEvents()})}),x.config.onChange.push(function(e){l.changeView(l.view.type,moment(e[0]).format("YYYY-MM-DD")),w(),D.classList.remove("show"),P.classList.remove("show")})})()});
